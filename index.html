
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡åŠ å¯†è§£å¯†å·¥å…·</title>
    <script type="text/javascript" src="https://me.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=Mc2rc_dKTLxvQ4QVzk8U3zR9IFZLvydiSS4qYkM_mbp3bQ8ySR123kgbnq2KkUq_" charset="UTF-8"></script><style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --danger: #e63946;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f5f5f5;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab.active {
            background: white;
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        
        .content {
            padding: 25px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .drop-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s;
            margin-bottom: 20px;
            cursor: pointer;
            position: relative;
        }
        
        .drop-area.highlight {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .drop-area i {
            font-size: 48px;
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-list {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .file-icon {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .file-name {
            font-weight: 500;
            word-break: break-all;
        }
        
        .file-size {
            color: var(--gray);
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .file-remove {
            color: var(--danger);
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.2rem;
            margin-left: 10px;
        }
        
        .password-group {
            margin: 20px 0;
        }
        
        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .password-input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary);
        }
        
        .btn-secondary {
            background: #e9ecef;
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background: #dee2e6;
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .container {
                border-radius: 10px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .drop-area {
                padding: 30px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å›¾ç‰‡åŠ å¯†è§£å¯†å·¥å…·</h1>
            <p>å®‰å…¨ã€å¿«é€Ÿã€æ— éœ€ä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="encrypt">å›¾ç‰‡åŠ å¯†</div>
            <div class="tab" data-tab="decrypt">å›¾ç‰‡è§£å¯†</div>
        </div>
        
        <div class="content">
            <!-- åŠ å¯†æ ‡ç­¾å†…å®¹ -->
            <div class="tab-content active" id="encrypt">
                <div class="drop-area" id="encrypt-drop-area">
                    <div class="loading" id="encrypt-loading">
                        <div class="spinner"></div>
                    </div>
                    <i>ğŸ“</i>
                    <h3>æ‹–æ”¾å›¾ç‰‡åˆ°è¿™é‡Œ</h3>
                    <p>æˆ–ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</p>
                    <input type="file" class="file-input" id="encrypt-file-input" multiple accept="image/*">
                </div>
                
                <div class="file-list" id="encrypt-file-list"></div>
                
                <div class="password-group">
                    <input type="password" class="password-input" id="encrypt-password" placeholder="è¾“å…¥åŠ å¯†å¯†ç ">
                </div>
                
                <button class="btn btn-primary" id="encrypt-btn">åŠ å¯†å¹¶å‹ç¼©ä¸‹è½½</button>
                
                <div class="progress-container" id="encrypt-progress">
                    <div class="progress-bar">
                        <div class="progress" id="encrypt-progress-bar"></div>
                    </div>
                    <div class="progress-text" id="encrypt-progress-text">å¤„ç†ä¸­...</div>
                </div>
                
                <div class="info-box">
                    <p><strong>æç¤ºï¼š</strong> åŠ å¯†åçš„æ–‡ä»¶å°†è‡ªåŠ¨æ‰“åŒ…ä¸ºZIPæ ¼å¼ä¸‹è½½ï¼Œè¯·å¦¥å–„ä¿ç®¡å¯†ç ã€‚</p>
                </div>
            </div>
            
            <!-- è§£å¯†æ ‡ç­¾å†…å®¹ -->
            <div class="tab-content" id="decrypt">
                <div class="drop-area" id="decrypt-drop-area">
                    <div class="loading" id="decrypt-loading">
                        <div class="spinner"></div>
                    </div>
                    <i>ğŸ“¦</i>
                    <h3>æ‹–æ”¾åŠ å¯†çš„ZIPæ–‡ä»¶åˆ°è¿™é‡Œ</h3>
                    <p>æˆ–ç‚¹å‡»é€‰æ‹©ZIPæ–‡ä»¶</p>
                    <input type="file" class="file-input" id="decrypt-file-input" accept=".zip,application/zip">
                </div>
                
                <div class="file-list" id="decrypt-file-list"></div>
                
                <div class="password-group">
                    <input type="password" class="password-input" id="decrypt-password" placeholder="è¾“å…¥è§£å¯†å¯†ç ">
                </div>
                
                <button class="btn btn-primary" id="decrypt-btn">è§£å¯†å¹¶ä¸‹è½½å›¾ç‰‡</button>
                
                <div class="progress-container" id="decrypt-progress">
                    <div class="progress-bar">
                        <div class="progress" id="decrypt-progress-bar"></div>
                    </div>
                    <div class="progress-text" id="decrypt-progress-text">å¤„ç†ä¸­...</div>
                </div>
                
                <div class="info-box">
                    <p><strong>æç¤ºï¼š</strong> è§£å¯†åå›¾ç‰‡å°†è‡ªåŠ¨æ‰“åŒ…ä¸‹è½½ï¼Œæ— éœ€æ‰‹åŠ¨è§£å‹ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„JavaScriptåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <script>
        // æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨æ ‡ç­¾å’Œå†…å®¹
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // æ¿€æ´»å½“å‰æ ‡ç­¾å’Œå†…å®¹
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // åŠ å¯†åŠŸèƒ½ç›¸å…³å˜é‡
        const encryptDropArea = document.getElementById('encrypt-drop-area');
        const encryptFileInput = document.getElementById('encrypt-file-input');
        const encryptFileList = document.getElementById('encrypt-file-list');
        const encryptPassword = document.getElementById('encrypt-password');
        const encryptBtn = document.getElementById('encrypt-btn');
        const encryptProgress = document.getElementById('encrypt-progress');
        const encryptProgressBar = document.getElementById('encrypt-progress-bar');
        const encryptProgressText = document.getElementById('encrypt-progress-text');
        const encryptLoading = document.getElementById('encrypt-loading');
        
        let encryptFiles = [];
        
        // è§£å¯†åŠŸèƒ½ç›¸å…³å˜é‡
        const decryptDropArea = document.getElementById('decrypt-drop-area');
        const decryptFileInput = document.getElementById('decrypt-file-input');
        const decryptFileList = document.getElementById('decrypt-file-list');
        const decryptPassword = document.getElementById('decrypt-password');
        const decryptBtn = document.getElementById('decrypt-btn');
        const decryptProgress = document.getElementById('decrypt-progress');
        const decryptProgressBar = document.getElementById('decrypt-progress-bar');
        const decryptProgressText = document.getElementById('decrypt-progress-text');
        const decryptLoading = document.getElementById('decrypt-loading');
        
        let decryptFile = null;
        
        // æ‹–æ”¾åŒºåŸŸäº‹ä»¶å¤„ç†
        function setupDropArea(dropArea, fileInput, fileList, isEncrypt) {
            // ç‚¹å‡»åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
            dropArea.addEventListener('click', (e) => {
                // é˜²æ­¢ç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶è§¦å‘æ–‡ä»¶é€‰æ‹©
                if (!e.target.classList.contains('file-remove')) {
                    fileInput.click();
                }
            });
            
            // æ‹–æ”¾äº‹ä»¶
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('highlight');
            }
            
            function unhighlight() {
                dropArea.classList.remove('highlight');
            }
            
            // å¤„ç†æ–‡ä»¶æ‹–æ”¾
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
            
            // å¤„ç†æ–‡ä»¶é€‰æ‹©
            fileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });
            
            function handleFiles(files) {
                if (files.length === 0) return;
                
                // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
                const loading = isEncrypt ? encryptLoading : decryptLoading;
                loading.style.display = 'flex';
                
                // ä½¿ç”¨setTimeoutç¡®ä¿UIæ›´æ–°
                setTimeout(() => {
                    try {
                        if (isEncrypt) {
                            // åŠ å¯†ï¼šå…è®¸å¤šä¸ªå›¾ç‰‡æ–‡ä»¶
                            for (let i = 0; i < files.length; i++) {
                                const file = files[i];
                                // æ›´å®½æ¾çš„æ–‡ä»¶ç±»å‹æ£€æµ‹
                                if (file.type.startsWith('image/') || 
                                    ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].some(ext => 
                                        file.name.toLowerCase().endsWith('.' + ext))) {
                                    encryptFiles.push(file);
                                }
                            }
                            updateEncryptFileList();
                        } else {
                            // è§£å¯†ï¼šåªå…è®¸ä¸€ä¸ªZIPæ–‡ä»¶
                            const file = files[0];
                            // æ›´å®½æ¾çš„ZIPæ–‡ä»¶æ£€æµ‹
                            if (file.type === 'application/zip' || 
                                file.type === 'application/x-zip-compressed' ||
                                file.name.toLowerCase().endsWith('.zip')) {
                                decryptFile = file;
                                updateDecryptFileList();
                            } else {
                                alert('è¯·é€‰æ‹©ZIPæ–‡ä»¶');
                            }
                        }
                    } catch (error) {
                        console.error('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™:', error);
                        alert('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ' + error.message);
                    } finally {
                        // éšè—åŠ è½½åŠ¨ç”»
                        loading.style.display = 'none';
                    }
                }, 10);
            }
        }
        
        // åˆå§‹åŒ–æ‹–æ”¾åŒºåŸŸ
        setupDropArea(encryptDropArea, encryptFileInput, encryptFileList, true);
        setupDropArea(decryptDropArea, decryptFileInput, decryptFileList, false);
        
        // æ›´æ–°åŠ å¯†æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
        function updateEncryptFileList() {
            encryptFileList.innerHTML = '';
            
            if (encryptFiles.length === 0) {
                encryptFileList.innerHTML = '<div class="file-item">æš‚æ— æ–‡ä»¶</div>';
                return;
            }
            
            encryptFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const fileInfo = document.createElement('div');
                fileInfo.className = 'file-info';
                
                const fileIcon = document.createElement('span');
                fileIcon.className = 'file-icon';
                fileIcon.innerHTML = 'ğŸ–¼ï¸';
                
                const fileName = document.createElement('div');
                fileName.className = 'file-name';
                fileName.textContent = file.name;
                
                const fileSize = document.createElement('div');
                fileSize.className = 'file-size';
                fileSize.textContent = formatFileSize(file.size);
                
                fileInfo.appendChild(fileIcon);
                fileInfo.appendChild(fileName);
                fileInfo.appendChild(fileSize);
                
                const fileRemove = document.createElement('button');
                fileRemove.className = 'file-remove';
                fileRemove.innerHTML = 'Ã—';
                fileRemove.setAttribute('data-index', index);
                
                fileItem.appendChild(fileInfo);
                fileItem.appendChild(fileRemove);
                
                encryptFileList.appendChild(fileItem);
            });
            
            // ä¸ºåˆ é™¤æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
            encryptFileList.querySelectorAll('.file-remove').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); // é˜²æ­¢è§¦å‘æ–‡ä»¶é€‰æ‹©
                    const index = parseInt(button.getAttribute('data-index'));
                    encryptFiles.splice(index, 1);
                    updateEncryptFileList();
                });
            });
        }
        
        // æ›´æ–°è§£å¯†æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
        function updateDecryptFileList() {
            decryptFileList.innerHTML = '';
            
            if (!decryptFile) {
                decryptFileList.innerHTML = '<div class="file-item">æš‚æ— æ–‡ä»¶</div>';
                return;
            }
            
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            const fileInfo = document.createElement('div');
            fileInfo.className = 'file-info';
            
            const fileIcon = document.createElement('span');
            fileIcon.className = 'file-icon';
            fileIcon.innerHTML = 'ğŸ“¦';
            
            const fileName = document.createElement('div');
            fileName.className = 'file-name';
            fileName.textContent = decryptFile.name;
            
            const fileSize = document.createElement('div');
            fileSize.className = 'file-size';
            fileSize.textContent = formatFileSize(decryptFile.size);
            
            fileInfo.appendChild(fileIcon);
            fileInfo.appendChild(fileName);
            fileInfo.appendChild(fileSize);
            
            const fileRemove = document.createElement('button');
            fileRemove.className = 'file-remove';
            fileRemove.innerHTML = 'Ã—';
            
            fileItem.appendChild(fileInfo);
            fileItem.appendChild(fileRemove);
            
            decryptFileList.appendChild(fileItem);
            
            // ä¸ºåˆ é™¤æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
            fileRemove.addEventListener('click', (e) => {
                e.stopPropagation(); // é˜²æ­¢è§¦å‘æ–‡ä»¶é€‰æ‹©
                decryptFile = null;
                updateDecryptFileList();
            });
        }
        
        // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // åŠ å¯†å‡½æ•° - ä½¿ç”¨AES-GCMç®—æ³•
        async function encryptData(data, password) {
            // ç”Ÿæˆéšæœºç›
            const salt = crypto.getRandomValues(new Uint8Array(16));
            
            // ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                new TextEncoder().encode(password),
                { name: 'PBKDF2' },
                false,
                ['deriveKey']
            );
            
            const key = await crypto.subtle.deriveKey(
                {
                    name: 'PBKDF2',
                    salt: salt,
                    iterations: 100000,
                    hash: 'SHA-256'
                },
                keyMaterial,
                { name: 'AES-GCM', length: 256 },
                false,
                ['encrypt']
            );
            
            // ç”ŸæˆéšæœºIV
            const iv = crypto.getRandomValues(new Uint8Array(12));
            
            // åŠ å¯†æ•°æ®
            const encryptedData = await crypto.subtle.encrypt(
                {
                    name: 'AES-GCM',
                    iv: iv
                },
                key,
                data
            );
            
            // ç»„åˆç›ã€IVå’ŒåŠ å¯†æ•°æ®
            const result = new Uint8Array(salt.length + iv.length + encryptedData.byteLength);
            result.set(salt, 0);
            result.set(iv, salt.length);
            result.set(new Uint8Array(encryptedData), salt.length + iv.length);
            
            return result;
        }
        
        // è§£å¯†å‡½æ•°
        async function decryptData(encryptedData, password) {
            try {
                // æå–ç›ã€IVå’ŒåŠ å¯†æ•°æ®
                const salt = encryptedData.slice(0, 16);
                const iv = encryptedData.slice(16, 28);
                const data = encryptedData.slice(28);
                
                // ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
                const keyMaterial = await crypto.subtle.importKey(
                    'raw',
                    new TextEncoder().encode(password),
                    { name: 'PBKDF2' },
                    false,
                    ['deriveKey']
                );
                
                const key = await crypto.subtle.deriveKey(
                    {
                        name: 'PBKDF2',
                        salt: salt,
                        iterations: 100000,
                        hash: 'SHA-256'
                    },
                    keyMaterial,
                    { name: 'AES-GCM', length: 256 },
                    false,
                    ['decrypt']
                );
                
                // è§£å¯†æ•°æ®
                const decryptedData = await crypto.subtle.decrypt(
                    {
                        name: 'AES-GCM',
                        iv: iv
                    },
                    key,
                    data
                );
                
                return new Uint8Array(decryptedData);
            } catch (error) {
                throw new Error('è§£å¯†å¤±è´¥ï¼Œå¯†ç å¯èƒ½ä¸æ­£ç¡®');
            }
        }
        
        // å¤„ç†åŠ å¯†æŒ‰é’®ç‚¹å‡»
        encryptBtn.addEventListener('click', async () => {
            if (encryptFiles.length === 0) {
                alert('è¯·é€‰æ‹©è¦åŠ å¯†çš„å›¾ç‰‡');
                return;
            }
            
            if (!encryptPassword.value) {
                alert('è¯·è¾“å…¥åŠ å¯†å¯†ç ');
                return;
            }
            
            try {
                encryptProgress.style.display = 'block';
                encryptBtn.disabled = true;
                
                const zip = new JSZip();
                const totalFiles = encryptFiles.length;
                let processedFiles = 0;
                
                // å¤„ç†æ¯ä¸ªæ–‡ä»¶
                for (const file of encryptFiles) {
                    encryptProgressText.textContent = `åŠ å¯†ä¸­: ${file.name} (${processedFiles + 1}/${totalFiles})`;
                    
                    // è¯»å–æ–‡ä»¶
                    const arrayBuffer = await readFileAsArrayBuffer(file);
                    
                    // åŠ å¯†æ•°æ®
                    const encryptedData = await encryptData(arrayBuffer, encryptPassword.value);
                    
                    // æ·»åŠ åˆ°ZIP
                    zip.file(file.name + '.enc', encryptedData);
                    
                    processedFiles++;
                    encryptProgressBar.style.width = `${(processedFiles / totalFiles) * 100}%`;
                }
                
                // ç”ŸæˆZIPæ–‡ä»¶
                encryptProgressText.textContent = 'ç”ŸæˆZIPæ–‡ä»¶ä¸­...';
                const zipBlob = await zip.generateAsync({ type: 'blob' }, (metadata) => {
                    encryptProgressBar.style.width = `${metadata.percent}%`;
                });
                
                // ä¸‹è½½ZIPæ–‡ä»¶
                saveAs(zipBlob, 'encrypted_images.zip');
                
                encryptProgressText.textContent = 'åŠ å¯†å®Œæˆï¼';
                
                // é‡ç½®çŠ¶æ€
                setTimeout(() => {
                    encryptProgress.style.display = 'none';
                    encryptBtn.disabled = false;
                    encryptFiles = [];
                    updateEncryptFileList();
                    encryptPassword.value = '';
                }, 2000);
                
            } catch (error) {
                console.error('åŠ å¯†é”™è¯¯:', error);
                alert('åŠ å¯†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message);
                encryptProgress.style.display = 'none';
                encryptBtn.disabled = false;
            }
        });
        
        // å¤„ç†è§£å¯†æŒ‰é’®ç‚¹å‡»
        decryptBtn.addEventListener('click', async () => {
            if (!decryptFile) {
                alert('è¯·é€‰æ‹©è¦è§£å¯†çš„ZIPæ–‡ä»¶');
                return;
            }
            
            if (!decryptPassword.value) {
                alert('è¯·è¾“å…¥è§£å¯†å¯†ç ');
                return;
            }
            
            try {
                decryptProgress.style.display = 'block';
                decryptBtn.disabled = true;
                
                // è¯»å–ZIPæ–‡ä»¶
                const arrayBuffer = await readFileAsArrayBuffer(decryptFile);
                const zip = await JSZip.loadAsync(arrayBuffer);
                
                const newZip = new JSZip();
                const fileNames = Object.keys(zip.files);
                const totalFiles = fileNames.length;
                let processedFiles = 0;
                
                // å¤„ç†ZIPä¸­çš„æ¯ä¸ªæ–‡ä»¶
                for (const fileName of fileNames) {
                    const zipFile = zip.files[fileName];
                    
                    // è·³è¿‡ç›®å½•
                    if (zipFile.dir) continue;
                    
                    decryptProgressText.textContent = `è§£å¯†ä¸­: ${fileName} (${processedFiles + 1}/${totalFiles})`;
                    
                    // è¯»å–åŠ å¯†æ–‡ä»¶
                    const encryptedData = await zipFile.async('uint8array');
                    
                    // è§£å¯†æ•°æ®
                    const decryptedData = await decryptData(encryptedData, decryptPassword.value);
                    
                    // è·å–åŸå§‹æ–‡ä»¶åï¼ˆå»æ‰.encæ‰©å±•åï¼‰
                    const originalName = fileName.endsWith('.enc') ? fileName.slice(0, -4) : fileName;
                    
                    // æ·»åŠ åˆ°æ–°ZIP
                    newZip.file(originalName, decryptedData);
                    
                    processedFiles++;
                    decryptProgressBar.style.width = `${(processedFiles / totalFiles) * 100}%`;
                }
                
                // ç”Ÿæˆæ–°ZIPæ–‡ä»¶
                decryptProgressText.textContent = 'ç”ŸæˆZIPæ–‡ä»¶ä¸­...';
                const zipBlob = await newZip.generateAsync({ type: 'blob' }, (metadata) => {
                    decryptProgressBar.style.width = `${metadata.percent}%`;
                });
                
                // ä¸‹è½½è§£å¯†åçš„ZIPæ–‡ä»¶
                saveAs(zipBlob, 'decrypted_images.zip');
                
                decryptProgressText.textContent = 'è§£å¯†å®Œæˆï¼';
                
                // é‡ç½®çŠ¶æ€
                setTimeout(() => {
                    decryptProgress.style.display = 'none';
                    decryptBtn.disabled = false;
                    decryptFile = null;
                    updateDecryptFileList();
                    decryptPassword.value = '';
                }, 2000);
                
            } catch (error) {
                console.error('è§£å¯†é”™è¯¯:', error);
                alert('è§£å¯†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message);
                decryptProgress.style.display = 'none';
                decryptBtn.disabled = false;
            }
        });
        
        // è¯»å–æ–‡ä»¶ä¸ºArrayBufferçš„è¾…åŠ©å‡½æ•°
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        // åˆå§‹åŒ–æ–‡ä»¶åˆ—è¡¨
        updateEncryptFileList();
        updateDecryptFileList();
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"54d37fb3eec7457d83784234f30440ca","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>